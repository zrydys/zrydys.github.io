<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>ZryDys Catalog - from  most visited effects last 2025</title>
 <link rel="stylesheet" type="text/css" href="catalog/products.css?v=.2" />
</head>
<body>
    <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
        <h4> ZryDys Catalog - from  most visited effects last 2025   </h4>
        <div class="filters">
            <input type="text" id="search" placeholder="Search results ...  â‡„ ">
              <!-- Buttons generated dynamically here
            <button class="filter-btn  " data-category="all">Toos</button> 
            <button class="filter-btn" data-category="Cyb" id="b-Cyb">Cyber</button>-->
         </div>
        
        <div id="catalog" class="catalog"></div>
    </div>




    <script>
        let products = [];
        let filteredProducts = [];
        let ell = null;
        
		window.onload = function() {  // to make sure the footer is loaded
			  ell = document.getElementById('current-url');
              if (ell) {            //console.info( `  sss=${ell} ` );
				ell.href = window.location.href;
				ell.textContent = window.location.href;
			  }
		}


        // Load JSON data
        async function loadProducts() {
            try {
                const response = await fetch('catalog/products.json?v=.9');
                const data = await response.json();
                products = data.products;
                                   console.info(   'load' ,  products );  //TO SET AFTER LOAD

				 // Get unique categories from JSON  arr.filter(item => item != null);  or   .filter(Boolean);
				var categories = ['all', ...new Set(products.map(p =>  (p.k)   )  )]  .filter( Boolean ); //no nulls
				categories = categories .map ( cada => String(cada).split(",") )  .flat() ; // enhanced to , separated  ,, then must search by .includes(  )
				categories = [...new Set(categories)] ;

  // Generate buttons HTML
  const filtersContainer = document.querySelector('.filters');
  const buttonsHtml = categories.map(cat => 
    `<button class="filter-btn" data-category="${cat}" id="b-${cat}" >${cat}</button>`
  ).join('');
  filtersContainer.innerHTML += buttonsHtml; // Append after search input
         
      // 1) Read "k" from query string: index.html?k=Home
    const params = new URLSearchParams(window.location.search);
    const k = params.get('k') || 'all'  ; // e.g. "Home" or all (if null)

    // 2) If k  , filter by category == k, else show all
    // filteredProducts = (k === 'all') ? [...products] :  products.filter(p => String(p.k) === String(k));  //toos vs filtered
        filteredProducts = (k === 'all') ? [...products] :  products.filter(p => String(p.k).includes( String(k) ) );  //toos vs filtered  ENHANCED to , separated
        
    
    //if (k === 'all') {      filteredProducts = [...products]; //toos
    // } else {      filteredProducts = products.filter(p => String(p.category) === String(k));      }      
           
    const myk = document.getElementById(`b-${k}`);   // activate the category buttom     
    if (myk) { myk.classList.add('active') 	} else { console.info( myk, k, `b-${k}` ) } ;
 
                renderCatalog();
                attachFilterListeners() ;
                attachSearchListeners() 
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('catalog').innerHTML = '<p>Error loading catalog</p>';
            }
        }

        function renderCatalog() {
            const catalog = document.getElementById('catalog');
            catalog.innerHTML = filteredProducts.map(product => `
                <div class="product">
                   <a href="${product.u || ''}"  target=_new >
                    <img src="${product.i}" alt="${product.n}" loading="lazy">
                    <h3>${product.n}</h3>
                   </a> 
                    <p>${product.d || ""}</p>
                    <div class="engine"> ${ product.k? product.k : '*'}  ${ product.p? product.p.toLocaleString('en-US', {style: 'currency', currency: 'USD'}) :"-" }</div>
                    <p class="author"> ${ product.a ? product.a : '<span class="out-stock">..</span>'}</p>
                </div>
            `).join('');
        }
 
        // Search functionality 
 function attachSearchListeners() {
                  console.info(   'search' ,  products );  //TO SET AFTER LOAD  so inside if load async
        document.getElementById('search').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            filteredProducts = products.filter(p => 
                p.n.toLowerCase().includes(term) //name
                 ||  p.d && p.d.toLowerCase().includes(term) //desc
                 ||  p.a && String(p.a).toLowerCase().includes(term)  // author
            );
 
		// ell 
		ell.href =   `/catalog.html?s=${term} `  ;
		ell.textContent =   `/catalog.html?s=${term} ` ;
 
				renderCatalog();
			});
	
}
 
//attachFilterListeners
function attachFilterListeners() {
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      const category = btn.dataset.category;
      
		
  // console.log ( window.location.href+"?&k="+category  );
  //const el = document.getElementById('current-url');
  // if (ell) {
    ell.href =  "/catalog.html?k="+category  ;
    ell.textContent =   "/catalog.html?k="+category  ;
  // }	
   
      if (category === 'all') {
        filteredProducts = [...products];
      } else {
        // filteredProducts = products.filter(p => p.k === category);
        filteredProducts = products.filter(p => p.k ?  p.k.includes(category) : false ); //also searches , separated
      }
      renderCatalog();
    });
  });
}
 
        // Initialize
        loadProducts();
    </script>
    

    
    
 <footer class="page-footer">
  <small>
    Current ZryDys.Github.IO page URL:   <a id="current-url" href=" "> </a>
  </small>
</footer>   

 

</body>
</html>
